{% extends 'home.html' %}

{% block home %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/character.css') }}">

<div class="builder-container">
    <div class="builder-card">
        <h2 class="builder-title">Welcome, {{ session.get('name', 'User') }}! <br>Create Your Avatar</h2>
        <p class="builder-subtitle">Define your unique skin & hair profile for personalized AI care.</p>

        <form action="{{ url_for('character_builder.character_builder') }}" method="POST" class="builder-form">
            
            <!-- SECTION 1: SKIN -->
            <div class="section-title">‚ú® Skin Profile</div>
            <div class="form-grid">
                
                <div class="form-group">
                    <label>Skin Type</label>
                    <select name="skin_type" required onchange="handleSkinType()">
                        <option value="" disabled selected>Select Type</option>
                        <option value="Oily">Oily</option>
                        <option value="Dry">Dry</option>
                        <option value="Combination">Combination</option>
                        <option value="Normal">Normal</option>
                        <option value="Sensitive">Sensitive</option>
                    </select>
                </div>

                <div class="form-group hidden" id="skin-oil-group">
                    <label>Skin Oil Level</label>
                    <input type="range" name="oil_level" min="1" max="3" step="1" list="level-markers-3">
                    <div class="range-labels">
                        <span>Low</span>
                        <span>High</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Skin Color</label>
                    <div class="color-options">
                        <label class="color-option" style="background-color: #F8D9C6;">
                            <input type="radio" name="skin_color" value="Fair" required>
                        </label>
                        <label class="color-option" style="background-color: #E0AC84;">
                            <input type="radio" name="skin_color" value="Medium">
                        </label>
                        <label class="color-option" style="background-color: #C68642;">
                            <input type="radio" name="skin_color" value="Olive">
                        </label>
                        <label class="color-option" style="background-color: #8D5524;">
                            <input type="radio" name="skin_color" value="Brown">
                        </label>
                        <label class="color-option" style="background-color: #3B2219;">
                            <input type="radio" name="skin_color" value="Dark">
                        </label>
                    </div>
                </div>

                <div class="form-group full">
                    <label>Concern Areas</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="skin_problems" value="Acne"> Acne</label>
                        <label><input type="checkbox" name="skin_problems" value="Pigmentation"> Pigmentation</label>
                        <label><input type="checkbox" name="skin_problems" value="Dark Circles"> Dark Circles</label>
                        <label><input type="checkbox" name="skin_problems" value="Wrinkles"> Wrinkles</label>
                        <label><input type="checkbox" name="skin_problems" value="Redness"> Redness</label>
                    </div>
                </div>
                
                 <!-- Dynamic Skin Fields -->
                 <div class="form-group">
                    <label>Acne Presence</label>
                    <div class="radio-group-inline">
                        <label><input type="radio" name="acne_presence" value="Yes" onchange="toggleField('acne-level-group', true)"> Yes</label>
                        <label><input type="radio" name="acne_presence" value="No" onchange="toggleField('acne-level-group', false)" checked> No</label>
                    </div>
                </div>
                <div class="form-group hidden" id="acne-level-group">
                    <label>Acne Level</label>
                    <input type="range" name="acne_level" min="1" max="3" step="1" list="level-markers-3">
                    <div class="range-labels">
                        <span>Mild</span>
                        <span>Severe</span>
                    </div>
                </div>

                 <div class="form-group" id="skin-dryness-wrapper">
                    <label>Skin Dryness</label>
                     <div class="radio-group-inline">
                        <label><input type="radio" name="dryness_presence" value="Yes" onchange="toggleField('dryness-level-group', true)"> Yes</label>
                        <label><input type="radio" name="dryness_presence" value="No" onchange="toggleField('dryness-level-group', false)" checked> No</label>
                    </div>
                </div>
                 <div class="form-group hidden" id="dryness-level-group">
                    <label>Dryness Level</label>
                    <input type="range" name="dryness_level" min="1" max="3" step="1" list="level-markers-3">
                    <div class="range-labels">
                        <span>Mild</span>
                        <span>Severe</span>
                    </div>
                </div>


                <div class="form-group">
                    <label>Sensitivity Level</label>
                    <input type="range" name="sensitivity_level" min="1" max="5" step="1" list="sensitivity-markers">
                    <datalist id="sensitivity-markers">
                        <option value="1" label="Low"></option>
                        <option value="2"></option>
                        <option value="3" label="Med"></option>
                        <option value="4"></option>
                        <option value="5" label="High"></option>
                    </datalist>
                    <!-- Shared Datalist for new 1-3 sliders -->
                    <datalist id="level-markers-3">
                        <option value="1" label="Low"></option>
                        <option value="2" label="Med"></option>
                        <option value="3" label="High"></option>
                    </datalist>

                    <div class="range-labels">
                        <span>Low</span>
                        <span>High</span>
                    </div>
                </div>

            </div>

             <!-- SECTION 2: HAIR -->
            <div class="section-title">üíá‚Äç‚ôÄÔ∏è Hair Profile</div>
            <div class="form-grid">
                
                <div class="form-group">
                    <label>Hair Type</label>
                    <select name="hair_type" required>
                        <option value="" disabled selected>Select Type</option>
                        <option value="Straight">Straight</option>
                        <option value="Wavy">Wavy</option>
                        <option value="Curly">Curly</option>
                        <option value="Coily">Coily</option>
                    </select>
                </div>

                 <div class="form-group">
                    <label>Hair Color</label>
                    <div class="color-options">
                        <label class="color-option" style="background-color: #090806;">
                            <input type="radio" name="hair_color" value="Black" required>
                        </label>
                        <label class="color-option" style="background-color: #3B3024;">
                            <input type="radio" name="hair_color" value="Dark Brown">
                        </label>
                        <label class="color-option" style="background-color: #B55239;">
                            <input type="radio" name="hair_color" value="Red">
                        </label>
                        <label class="color-option" style="background-color: #E6CEA8;">
                            <input type="radio" name="hair_color" value="Blonde">
                        </label>
                        <label class="color-option" style="background-color: #A7856A;">
                            <input type="radio" name="hair_color" value="Light Brown">
                        </label>
                         <label class="color-option" style="background-color: #E5E5E5;">
                            <input type="radio" name="hair_color" value="Grey/White">
                        </label>
                    </div>
                </div>

                <div class="form-group full">
                    <label>Hair Concerns</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="hair_problems" value="Hairfall"> Hairfall</label>
                        <label><input type="checkbox" name="hair_problems" value="Dandruff"> Dandruff</label>
                        <label><input type="checkbox" name="hair_problems" value="Split Ends"> Split Ends</label>
                        <label><input type="checkbox" name="hair_problems" value="Frizzy"> Frizzy</label>
                        <label><input type="checkbox" name="hair_problems" value="Breatkage"> Breakage</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Hair Fall Level</label>
                    <input type="range" name="hair_fall_level" min="1" max="3" step="1" list="level-markers-3">
                    <div class="range-labels">
                        <span>Low</span>
                        <span>High</span>
                    </div>
                </div>


                 <!-- Dynamic Hair Fields -->
                 <div class="form-group">
                    <label>Hair/Scalp Dryness</label>
                     <div class="radio-group-inline">
                        <label><input type="radio" name="hair_dryness_presence" value="Yes" onchange="toggleField('hair-dryness-level-group', true)"> Yes</label>
                        <label><input type="radio" name="hair_dryness_presence" value="No" onchange="toggleField('hair-dryness-level-group', false)" checked> No</label>
                    </div>
                </div>
                 <div class="form-group hidden" id="hair-dryness-level-group">
                    <label>Dryness Level</label>
                    <input type="range" name="hair_dryness_level" min="1" max="3" step="1" list="level-markers-3">
                    <div class="range-labels">
                        <span>Mild</span>
                        <span>Severe</span>
                    </div>
                </div>

                 <div class="form-group">
                    <label>Scalp Itch</label>
                     <div class="radio-group-inline">
                        <label><input type="radio" name="scalp_itch_presence" value="Yes" onchange="toggleField('scalp-itch-level-group', true)"> Yes</label>
                        <label><input type="radio" name="scalp_itch_presence" value="No" onchange="toggleField('scalp-itch-level-group', false)" checked> No</label>
                    </div>
                </div>
                 <div class="form-group hidden" id="scalp-itch-level-group">
                    <label>Itch Level</label>
                    <input type="range" name="scalp_itch_level" min="1" max="3" step="1" list="level-markers-3">
                    <div class="range-labels">
                        <span>Mild</span>
                        <span>Severe</span>
                    </div>
                </div>


                  <div class="form-group">
                    <label>Scalp Condition</label>
                    <select name="scalp_condition" required onchange="handleScalpCondition()">
                         <option value="" disabled selected>Select Condition</option>
                        <option value="Oily">Oily</option>
                        <option value="Dry">Dry</option>
                        <option value="Normal">Normal</option>
                        <option value="Flaky">Flaky</option>
                    </select>
                </div>

            </div>

             <div class="section-title">üè† Lifestyle</div>
             <div class="form-group">
                <label>Primary Environment</label>
                 <div class="radio-group-inline">
                    <label><input type="radio" name="lifestyle" value="Indoor"> Indoor</label>
                    <label><input type="radio" name="lifestyle" value="Outdoor"> Outdoor</label>
                </div>
            </div>

            <!-- Script for Dynamic Logic -->
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    // Initial check
                    handleSkinType();
                    handleScalpCondition();
                });

                function toggleField(elementId, show) {
                    const el = document.getElementById(elementId);
                    if (!el) return;
                    
                    if (show) {
                        el.classList.remove('hidden');
                        const input = el.querySelector('input');
                        if (input) input.setAttribute('required', 'required'); 
                    } else {
                        el.classList.add('hidden');
                        const input = el.querySelector('input');
                        if (input) {
                            input.removeAttribute('required');
                            input.value = ''; // Clean up
                        }
                    }
                }

                function handleSkinType() {
                    const skinType = document.querySelector('select[name="skin_type"]').value;
                    const oilGroup = document.getElementById('skin-oil-group');
                    const drynessGroup = document.getElementById('dryness-group'); // Container for presence+level
                    const drynessPresenceYes = document.querySelector('input[name="dryness_presence"][value="Yes"]');
                    const drynessPresenceNo = document.querySelector('input[name="dryness_presence"][value="No"]');
                    
                    // Logic: Oily -> Show Oil Level
                    if (skinType === 'Oily') {
                        if(oilGroup) toggleField('skin-oil-group', true);
                    } else {
                        if(oilGroup) toggleField('skin-oil-group', false);
                    }

                    // Logic: Dry -> Show Dryness Level (Auto-select Yes)
                    if (skinType === 'Dry') {
                         // Auto-set presence to Yes and show level
                         if(drynessPresenceYes) drynessPresenceYes.click();
                         // Optional: Hide the presence toggle purely if we want to force it, 
                         // but keeping it visible as a confirmation is safer for now, 
                         // or we can hide the wrapper 'skin-dryness-presence-wrapper' if requested.
                         // User said "show skin dry level".
                    } else {
                        // If switching away from Dry, should we auto-reset? 
                        // Maybe safer to default to No if it was auto-set? 
                        // For UX, if user selected Dry then changed mind, we reset.
                        if(drynessPresenceNo && skinType !== '') drynessPresenceNo.click();
                    }
                }

                function handleScalpCondition() {
                    const condition = document.querySelector('select[name="scalp_condition"]').value;
                    const hairDrynessPresenceYes = document.querySelector('input[name="hair_dryness_presence"][value="Yes"]');
                    const hairDrynessPresenceNo = document.querySelector('input[name="hair_dryness_presence"][value="No"]');

                    // If Scalp is Dry -> Auto-trigger Hair Dryness logic
                    if (condition === 'Dry') {
                        if(hairDrynessPresenceYes) hairDrynessPresenceYes.click();
                    } else {
                         if(hairDrynessPresenceNo && condition !== '') hairDrynessPresenceNo.click();
                    }
                }
            </script>
            
            <style>
                .hidden { display: none !important; }
                .radio-group-inline { display: flex; gap: 1rem; margin-top: 0.5rem; }
                .radio-group-inline label { cursor: pointer; display: flex; align-items: center; gap: 0.3rem;}
            </style>

            <!-- SECTION 3: ALLERGIES -->
            <div class="section-title">üö´ Allergies</div>
            <div class="form-group full">
                <label>Do you have any known allergies?</label>
                <div class="checkbox-group wide">
                    <label><input type="checkbox" name="allergies" value="Peanuts"> Peanuts</label>
                    <label><input type="checkbox" name="allergies" value="Dairy"> Dairy</label>
                    <label><input type="checkbox" name="allergies" value="Gluten"> Gluten</label>
                    <label><input type="checkbox" name="allergies" value="Latex"> Latex</label>
                    <label><input type="checkbox" name="allergies" value="Fragrance"> Fragrance</label>
                     <label><input type="checkbox" name="allergies" value="Aloe Vera"> Aloe Vera</label>
                    <label><input type="checkbox" name="allergies" value="Coconut"> Coconut</label>
                     <label><input type="checkbox" name="allergies" value="Sulphates"> Sulphates</label>
                </div>
            </div>

            <button type="submit" class="btn-create">‚ú® Generate My Profile</button>
        </form>
    </div>
</div>
{% endblock home %}
